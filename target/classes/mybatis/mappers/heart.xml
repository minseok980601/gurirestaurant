<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="mapper.herat">
	<resultMap type="heartDTO" id="heartResult">
		<result property="h_no" column="h_no"/>
		<result property="gr_no" column="gr_no"/>
		<result property="id" column="id"/>	
		<result property="steamcheck" column="steamcheck"/>
	</resultMap>
	
	<select id="findHeart" parameterType="java.util.HashMap" resultType="heartDTO">
		<![CDATA[
			SELECT *
			FROM GR_HEART
			WHERE GR_NO = #{gr_no} AND ID = #{kim}
		]]>
	</select>
	
	<!-- 찜 1로 만들어서 중복 방지 -->
	<update id="heartUpdateCheck">
		<![CDATA[
			UPDATE GR_HEART 
			SET steamcheck = 1
			WHERE gr_no = #{gr_no} AND id = #{id}
		]]>
	</update>
	
	<select id="heartCheck" resultType="int">
		<![CDATA[
			select count(*)
			from gr_heart
			where gr_no = #{gr_no} and id = #{id}
		]]>
	</select>
	
	<update id="restaurantUpHeart" parameterType="int">
		<![CDATA[
			UPDATE GURI_RESTAURANT 
			SET HEART = HEART + 1
			WHERE GR_NUM = #{gr_num}
		]]>
	</update>
	
	<insert id="heartRestaurant" parameterType="java.util.Map">
		<![CDATA[
			INSERT INTO GR_HEART (h_no, gr_no, id)
			values((SELECT NVL(MAX(h_no), 0) + 1 FROM GR_HEART), #{gr_no}, #{id})
		]]>
	</insert>
</mapper>